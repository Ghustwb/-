### 下一站挤不挤？智能系统告诉你！

刚刚看到新闻，上海公交站已经开始了一个新的[智能系统](https://mp.weixin.qq.com/s/lWnQWV7b8yeOLRYYngllRA)的试运行。这个智能系统可以提示乘客下一辆车的拥挤程度，这个可是比只能提示下一辆车还有多久到的系统智能多了。

刚看到这个新闻我就在想，这个是基于什么原理做的呢？什么样的方案才能成本最小？ 脑海里第一个出来的就是图像，只有基于图像做，每辆车的成本就只需要控制在几个摄像头的价格内，妥妥的可以大力推广的方案。

经过查看进一步的信息，这个系统是上海理工大学光电信息与计算机工程学院陈庆奎教授团队做的，在旧的公交车上没有新增摄像头，只需要将原有的摄像头画面采集进行分析就可以了，里面的原理就我们CV党常说的**人群密度估计**。

---

下面我们聊聊人群密度估计

**前言**

人群密度估计在安防领域应用最多，例如我之前工作过的一家公司，就有一个项目需求是通过摄像头对广场上的行人监控，如果有聚集，打架等行为就要通知保安。这样的需求例子还有很多，例如很多大型的活动中经常会发生踩踏事故，在2015年元旦上海外滩踩踏事故就是一个惨痛的教训。所以安防行业对这种类型的研究也越来越重视。

![外滩跨年](https://i.loli.net/2019/12/13/S2o9WMd5x6tgfaE.jpg)

**人群计数方法**

常见的人群计数方法分为两类：

- 基于行人检测
- 基于密度回归

早期的人群研究算法都是基于检测做的，基于检测的方法也有两种，第一种是基于整体检测，另一种是基于部分检测。检测算法就是在全图中使用检测的方法来得到图中人群的数量和位置，基于整体的检测在稀疏人群中的效果比较好，但是随着遮挡严重之后，其检出率大大降低；基于部分身体检测的算法，其天生的缺陷就是容易误检。

所以现在研究人群密度估计大都是基于回归的方法。

其主要思想是通过学习一种图像特征到人群数量的映射，将人群图像和人群数量建立一种联系。一般是先提取特征，然后利用回归模型进行回归，得到特征到任务数量的映射，在深度学习里面，直接进行end2end的训练，从图片直接生成人群数量。

1、[MCNN](<https://zpascal.net/cvpr2016/Zhang_Single-Image_Crowd_Counting_CVPR_2016_paper.pdf>) 

mcnn方法是cvpr2016提出来的，如图所示，mcnn利用3个具有不同卷积核大小的网络来分别提取人群图像的特征，最后将3个尺度的特征通过1×1卷积来融合。最后输出Desnsity map.

![](https://i.loli.net/2019/12/13/zxbrOhP3qoaH9MX.png) 

 

2、[CP-CNN](<http://openaccess.thecvf.com/content_ICCV_2017/papers/Sindagi_Generating_High-Quality_Crowd_ICCV_2017_paper.pdf>) 

 CP-CNN设计了两个网络分别用于提取全局上下文信息和局部上下文信息,设计了一个类似mcnn的多列cnn用于将输入数据映射到一个高维度的特征图,将之前提取到的上下文信息和高维特征图融合在一起,输入最后的融合网络,由最后的融合网络生成最终的密度图.  ![CP-CNN](https://i.loli.net/2019/12/13/Cumnax7yb3wLdig.png)

 3、[Switch-CNNCSRNet](<https://www.zpascal.net/cvpr2018/Li_CSRNet_Dilated_Convolutional_CVPR_2018_paper.pdf>)

这是cvpr2018提出的一种新方法，CSRNet由两个主要组件组成：CNN作为2D特征提取的前端，而扩张的CNN则作为后端，后者使用扩张的内核提供更大的感受野并代替合并操作。 CSRNet具有纯卷积结构，因此是易于训练的模型。在四个数据集（ShanghaiTech，UCF CC 50，WorldEXPO’10UCSD)上进行了测试，达到SOAT的效果 ![](https://i.loli.net/2019/12/13/MnLwEONQXu8soGv.png)



4、[Scale-Aware Attention Network for Crowd Counting](<https://arxiv.org/pdf/1901.06026.pdf>)

这篇文章来自亚马逊，其提出了一种新的多分支尺度感知注意网络，利用卷积神经网络的层次结构，并在单个前向传播中生成来自架构不同层的多尺度密度预测。为了将这些 maps 聚合到最终预测中，提出了一种新的 soft 注意力机制，其可以学习一组 gating masks。此外，我们引入了规模感知损失函数来规范不同分支的训练并指导它们专门研究特定的尺度。由于这种新训练需要对每个头部的大小进行 ground-truth 标注，我们还提出了一种简单而有效的技术来自动估计它。最后，我们对每个部分进行ablation study ，并将我们的方法与4个人群计数数据集的文献进行比较：UCF-QNRF，ShanghaiTech A＆B和UCF_CC_50。实验结果表明，我们的方法在这些数据集上取得最先进技术的水平（state-of-the-art，SOTA）。我们观察到UCF-QNRF显著提高（25％），其他显著提高（约10％）。

![](https://i.loli.net/2019/12/13/jQXfCpuULKlJVMS.png)

---

以上只是几篇比较引用比较多的文章汇总，有兴趣的可以去仔细读一下原文。

上海公交站的拥挤程度预测，最后输出的是三个图标，分别代表，舒适，一般，拥挤，三个状态。理论上如果最后只要三个状态，后面使用分类，应该问题不大。





















